# CloudTech Study

## 11.

- SageMaker Pipelines を使用する。モデルのバージョンが登録されたら、AWS SDK を使用して承認ステータスを『承認済み』に変更する
  - SageMaker Pipelines は、ML ワークフローの自動化と管理を目的とした強力なツールです。
  - この機能により、モデルの登録後に手動承認を含むステップを統合できます。
  - 特に、承認ステータスを AWS SDK を用いて「承認済み」に変更することで、モデルが適切なプロセスを経て本番環境にデプロイされることを保証できます。
  - このアプローチは、コンプライアンスやガバナンスの要件を満たしつつ、運用上の一貫性を確保するのに適しています。
- SageMaker Experiments は、ML の実験管理や比較に役立つツール
- SageMaker ML Lineage Tracking は、データやモデルのトレーニング履歴、依存関係を追跡するのに適しています
- SageMaker Model Monitor は、デプロイされたモデルのパフォーマンスを監視するためのツールであり、運用中のモデルのデータドリフトや性能低下を検知します。

## 12.

- SageMaker Autopilot を使用して、SageMaker JumpStart によってデプロイされた LLM を微調整する。
  - SageMaker JumpStart は、事前学習済みのモデルを簡単に利用し、微調整するためのテンプレートや機能を提供します。
  - SageMaker Autopilot はローコード／ノーコード（LCNC）アプローチを可能にし、複雑な設定をせずにモデルのトレーニングと微調整を行うことができます。
  - この組み合わせにより、ML エンジニアは高性能なモデルを迅速に微調整し、プロダクションに導入できます。

## 13.

- Amazon SageMaker 上でのデプロイ
  - サーバーレス推論エンドポイントを使用します。MaxConcurrency パラメータを 1 に設定します。
    - サーバーレス推論エンドポイントは、使用頻度が低い推論ワークロードに最適であり、毎晩 1 回の実行という要件に完全に適しています。
    - このエンドポイントは、リクエストがない場合にリソースを解放するため、コスト効率が高いです。
    - また、推論の短時間完了要件（1 分未満）にも十分に対応できます。
    - MaxConcurrency パラメータを 1 に設定することで、同時実行リクエストの処理能力を必要な範囲に制限し、リソース効率をさらに最適化します。
  - マルチモデルサーバーレスエンドポイントを使用します。キャッシュを有効にします。
    - マルチモデルサーバーレスエンドポイントは複数のモデルをホストする場合に有効
  - 非同期推論エンドポイントを使用します。InitiallnstanceCount パラメータを O に設定します。
    - 非同期推論はバッチ処理向けであり、即時性が求められるワークロードには適していません。
    - このシナリオではリアルタイム性が必要で、非同期推論は要件を満たしません。
  - リアルタイムエンドポイントを使用します。 モデルが使用されていないときにモデルを 0 にスケールするオートスケーリングポリシーを設定します。
    - リアルタイムエンドポイントは常にインフラストラクチャを稼働させる必要があり、使用頻度が低いこのケースではコストが高くなります。
    - サーバーレス推論の方がコスト効率に優れています。

## 14.

- Amazon EMR クラスタで大量のバッチ処理をする場合
  - プライマリノードとコアノードをオンデマンドインスタンスで実行する。タスクノードをスポットインスタンスで実行する。
  - プライマリノードはクラスタ全体を管理し、データの軽合性を確保するため、常時稼働が必要です。
  - コアノードは HDFS ストレージを提供するため、データ損失を防ぐためにもオンデマンドインスタンスを使用する必要があります。
  - 一方、タスクノードはデータを保持せず、ジョブ実行専用であるため、コスト効率を重視してスポットインスタンスを利用できます。
  - オンデマンドインスタンスをすべてのノードに適用すると高コストになるため、コスト効率を求める要件を満たしません。

## 17.

- SageMaker Clarify ジョブを実行する AWS Lambda 関数を呼び出すようにアプリケーションを設定する
  - SageMaker Clarity は、機械学習モデルにおけるバイアスを検出し、説明可能性を向上させるためのツールです。
  - リアルタイムでバイアスドリフトを監視する必要がある場合、Clarify ジョブを AWS Lambda 関数でトリガーすることで、オンデマンドでバイアス分析を実行できます。
    このアプローチは、モデルのパフォーマンスを継続的に評価し、偏りのある結果が生じた場合に迅速に対応できる柔軟性を提供します。
  - また、Lambda 関数を介して実行することで、オンデマンドの分析が容易になり、運用コストを最小限に抑えながら動的な監視を実現します。
- AWS Lambda 関数を呼び出して、SageMaker 組み込みの sagemaker-model-monitor-analyzer イメージをプルする。
  - sagemaker-model-monitor-analyzer はデータドリフトやモデルパフォーマンスを監視するのに有効ですが、バイアスドリフトを検出する目的には直接的には対応していません。
  - バイアスドリフトを監視するには、SageMaker Clarify のような特化したツールを使用する必要があります。
- AWS Glue Data Quality を使用してバイアスを監視する。
  - AWS Glue Data Quality は、データの品質や整合性を評価するツールであり、バイアスドリフトを特定するための機能は備わっていません。
- エンドポイントにデプロイされたモデルのバイアスドリフト
  - これは本番環境で利用されている機械学習モデルが、新しいデータに対して予測を行う際に、偏り（バイアス）が徐々に変化していく現象を指します。
  - 具体的には以下のような状況を含みます
    - データの分布が変化するモデルのトレーニングに使用されたデータと、本番環境で入力されるデータの分布が異なる場合、モデルの予測に偏りが生じる可能性があります（例：特定の属性を持つデータに対する予測が不正確になる）。
    - モデルが特定のグループに対して一貫性を失う性別や年齢などの属性ごとに子測結果が変化し、以前よりも公平性が低下している場合があります。
    - ビジネス上の基準や法律に違反するリスクたとえば、あるモデルがローン審査に使用されている場合、性別や人種などに基づいた差別的な結果が出る可能性があります。
    - そのような偏りが時間とともに変化・拡大すると、倫理的・法的な問題に発展する恐れがあります。
  - 「バイアスドリフト」を検出・監視することは、モデルが公平かつ頼性を持って機能しているかを確認するために非常に重要です。
  - この文脈では、SageMaker Clarify などのツールを使って、モデルの予測結果における偏りやドリフトをリアルタイムで分析する仕組みを構築することを意味します。

## 18.

- Amazon SageMaker Model Registry を使用して、Amazon ECR でホストされているモデルのモデルグループを作成します。新しい
  AWS アカウントを作成します。新しいアカウントで、SageMaker Model Registry をセントラルカタログとして使用します。初期の AWS アカウント内の各モデルグループに、アカウント間リソースポリシーをアタッチします。

  - SageMaker Model Registry は、モデルのバージョン管理、承認、デプロイメント追跡を簡単に行える専用のレジストリサービスです。
  - このサービスは、複数の AWS アカウントでモデルを一元管理し、セントラルカタログとして機能するのに適しています。
  - また、モデルグループを作成し、アカウント間で共有するリソースポリシーを設定することで、複数のチームやプロジェクト間で効率的なアクセスを実現します。

- 具体的なフロー（処理の流れ）

1. データサイエンスチームがモデルを開発（開発用 AWS アカウント）

- モデルをトレーニングし、成果物を Amazon ECR に登録
- SageMaker Model Registry に 新しいバージョンとして追加

2. ML オペレーションチームがモデルを承認（Model Registry 用 AWS アカウント）

- SageMaker Model Registry に登録されたモデルをレビュー
- 承認すると 「Approved」ステータス に変更
- 承認フローは Step Functions + Lambda で自動化

3. モデルを本番環境用アカウントにデプロイ

- 承認済みのモデルを 本番環境の SageMaker エンドポイントにデプロイ
- IAM リソースポリシーで、特定のアカウントのみモデル取得を許可

4. モデルのバージョン管理 & ロールバック可能

- モデルのバージョンを SageMaker Model Registry に記録
- 過去のバージョンにロールバック可能（バグ修正や最適化時に便利）

## 19.

- Amazon SageMaker Data Wrangler を使用して、異常を自動的に検出し、結果を可視化する
  - SageMaker Data Wrangler は、データの取り込み、前処理、異常検出、および可視化を一元的に実施できるツールです。
  - さらに、結果を可視化するための機能を備えており、追加でツールなどを必要としません。
  - このサービスは、異常値の検出やデータセットの特徴の分析に特化しており、ノーコードまたはローコードで複雑なデータ処理を効率的に行えます。

## 20.

- Firehose ストリームでゼロバッファリングを使用します。PutRecordBatch 操作で使用されるバッチサイズを調整します。
  - Firehose ストリームのゼロバッファリングを有効にすることで、データは可能な限り最短時間で送信されます。
  - この設定により、サブ秒単位のレイテンシ要件を満たすことができます。
  - また、PutRecordBatch 操作のバッチサイズを適切に調整することで、リアルタイム処理の効率を最大化できます。
- Firehose ストリームを AWS DataSync タスクに置き換えます。拡張ファンアウトコンシューマーを使用してタスクを設定します。
  - DataSync は主にバッチ転送に適しており、リアルタイム処理には向いていません。
  - また、拡張ファンアウトは Amazon Kinesis のコンシューマーであり、Firehose のユースケースではありません。
